

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Network Virtualization Device &mdash; Sipa Linux Admin Class latest documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Sipa Linux Admin Class latest documentation" href="index.html"/>
        <link rel="next" title="Openstack with Packstack" href="packstack.html"/>
        <link rel="prev" title="ISCSI Remote Storage" href="iscsi.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Sipa Linux Admin Class
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="systemd.html">Understand systemd</a></li>
<li class="toctree-l1"><a class="reference internal" href="journal.html">Journalclt</a></li>
<li class="toctree-l1"><a class="reference internal" href="configip.html">Configure IP address</a></li>
<li class="toctree-l1"><a class="reference internal" href="firewall.html">Understand New Linux Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="sshd.html">SSH Server On CentOS7</a></li>
<li class="toctree-l1"><a class="reference internal" href="setupvm.html">SetupVM for Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="vagrant.html">Build Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="bridgekvm.html">Bridge Networking KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="ovs.html">OpenVswitch Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="team.html">Network Teaming &amp; Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="lvm.html">Linux LVM partition</a></li>
<li class="toctree-l1"><a class="reference internal" href="iscsi.html">ISCSI Remote Storage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Network Virtualization Device</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#network-bridge">Network Bridge</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-setup">Getting Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ip-command">IP Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linux-bridge">Linux bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iproute2">iproute2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bridge-utils">bridge-utils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ovs-project">OVS-project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#test-plan">Test plan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#turnon-interface-add-ip">ขั้นตอนต่อมาคือ turnon interface และ add ip</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="packstack.html">Openstack with Packstack</a></li>
<li class="toctree-l1"><a class="reference internal" href="openstack-intro.html">Openstack intro Mitaka Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Lab Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="keystone.html">Install keystone</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Sipa Linux Admin Class</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Network Virtualization Device</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/virtualdev.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="network-virtualization-device">
<h1>Network Virtualization Device<a class="headerlink" href="#network-virtualization-device" title="Permalink to this headline">¶</a></h1>
<div class="section" id="network-bridge">
<h2>Network Bridge<a class="headerlink" href="#network-bridge" title="Permalink to this headline">¶</a></h2>
<div class="section" id="getting-setup">
<h3>Getting Setup<a class="headerlink" href="#getting-setup" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p>เราสามารถสร้าง network bridge เพื่อทำหน้าที่เป็น virtual switch ใน linux เพื่อให้รองรับการสร้าง vm guest โดย   vm จะเชื่อมต่ออยู่กับ Network Adapter ที่สร้างที่อยู่บน bridge เดียวกันจะสามารถสื่อสารระหว่างกันได้  เหมือนกับการต่ออยู่กับ physical switch.
ก่อนหน้านี้เราใช้คำสั่ง brctl จาก package ชื่อ bridge-utils ในการสร้าง bridge และทำการเชื่อม bridgeกับ interface ปัจจุบัน สามารถใช้คำสั่ง ip ที่อยู่ใน package ชื่อ iproute3</p>
</div>
<div class="section" id="ip-command">
<h4>IP Command<a class="headerlink" href="#ip-command" title="Permalink to this headline">¶</a></h4>
<p>คำสั่ง ip เป็นคำสั่งที่อยู่ใน package  iproute3 ส่วนคำสั่ง ifconfig จะอยู่ใน package nettools</p>
<img alt="_images/Linux-Nettools-vs-Iproute2.png" src="_images/Linux-Nettools-vs-Iproute2.png" />
<p>Syntax</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">OBJECT</span> <span class="n">COMMAND</span>
<span class="n">ip</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="n">OBJECT</span> <span class="n">COMMAND</span>
<span class="n">ip</span> <span class="n">OBJECT</span> <span class="n">help</span>
</pre></div>
</div>
<p>Object สามารถ แทนค่าได้ตามตารางด้านล่าง ทั้งแบบเต็มหรือแบบย่อ</p>
<img alt="_images/ipobject.png" src="_images/ipobject.png" />
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~</span>
<span class="n">mkdir</span> <span class="n">bridge</span>
<span class="n">cd</span> <span class="n">bridge</span>
<span class="n">vagrant</span> <span class="n">init</span> <span class="n">centos</span><span class="o">/</span><span class="mi">7</span>
<span class="n">vagrant</span> <span class="n">up</span>
<span class="n">vagrant</span> <span class="n">ssh</span>
<span class="n">sudo</span> <span class="n">su</span> <span class="o">-</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">su</span> <span class="o">-</span>
<span class="n">ip</span> <span class="n">addr</span>
<span class="n">ip</span> <span class="n">addr</span> <span class="n">show</span> <span class="n">eth0</span>
<span class="n">ip</span> <span class="n">route</span> <span class="n">show</span>
<span class="n">traceroute</span> <span class="n">google</span><span class="o">.</span><span class="n">com</span>

    <span class="o">//</span><span class="nb">list</span> <span class="n">interface</span>
    <span class="n">ip</span> <span class="n">link</span>

    <span class="c1">#เพิ่ม ip ให้ interface</span>
    <span class="c1"># syntax: ip a add {ip_addr/mask} dev {interface}</span>
    <span class="n">ip</span> <span class="n">a</span> <span class="n">add</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.200</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">eth0</span>
    <span class="n">ip</span> <span class="n">a</span> <span class="n">s</span> <span class="n">eth0</span>

    <span class="c1">#เปลี่ยนแปลงค่า MTU</span>
    <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">mtu</span> <span class="mi">9000</span> <span class="n">dev</span> <span class="n">eth0</span>
    <span class="n">ip</span> <span class="n">a</span> <span class="n">s</span> <span class="n">eth0</span>

    <span class="c1">#เปลี่ยน route ให้ไปออกที่ eth2 และมี next ip 192.168.1.100</span>
    <span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="n">default</span> <span class="n">via</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.100</span> <span class="n">dev</span> <span class="n">eth2</span>
    <span class="n">ip</span> <span class="n">route</span>
    <span class="c1">#ลบ ip route</span>
    <span class="n">ip</span> <span class="n">route</span> <span class="k">del</span> <span class="n">default</span> <span class="n">via</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.100</span> <span class="n">dev</span> <span class="n">eth2</span>

    <span class="n">ip</span> <span class="n">link</span>

    <span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">br0</span> <span class="nb">type</span> <span class="n">bridge</span>

    <span class="c1">#เพิ่ม physical network interface ไปยัง bridge  ที่สร้างมา</span>
    <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span> <span class="n">master</span> <span class="n">br0</span>

    <span class="c1">#เพิ่มip</span>
    <span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.100</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">br0</span>
    <span class="c1">#ลบip</span>
    <span class="n">ip</span> <span class="n">addr</span> <span class="k">del</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.100</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">br0</span>
</pre></div>
</div>
</div>
<div class="section" id="linux-bridge">
<h4>Linux bridge<a class="headerlink" href="#linux-bridge" title="Permalink to this headline">¶</a></h4>
<p>เพื่อเชื่อมเครื่องคอมพิวเตอร์ เข้าหากัน โดยการใช้ Mac Address (Layer 2) แทนที่จะเป็นการเชื่อมกันระหว่าง ip (Layer3) โดยปรกติ linux network จะป้องกันไม่ให้ส่ง traffice จาก interface หนึ่งไปอีก interface หนึ่ง เราอาจ ใช้  ip routing ให้ทำหน้าที่ในการส่งข้อมูล ด้วยการกำหนดค่า ใน sysctrl เป็นการทำ ip forward</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">ip_forward</span>
<span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctrl</span><span class="o">.</span><span class="n">conf</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">ip_forward</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sysctl</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">conf</span>
<span class="n">service</span> <span class="n">network</span> <span class="n">restart</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">ip_forward</span>
</pre></div>
</div>
<p>Linux kernel ยังสามารถ bridge ระหว่าง interface เพื่อส่งผ่าน ethernet frame การสร้าง linux bridge ได้หลายหลายวิธี  โดยมี kernel module</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">lsmod</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">bridge</span>
<span class="n">bridge</span>                <span class="mi">126976</span>  <span class="mi">1</span> <span class="n">ebtable_broute</span>
<span class="n">stp</span>                    <span class="mi">16384</span>  <span class="mi">2</span> <span class="n">garp</span><span class="p">,</span><span class="n">bridge</span>
<span class="n">llc</span>                    <span class="mi">16384</span>  <span class="mi">3</span> <span class="n">stp</span><span class="p">,</span><span class="n">garp</span><span class="p">,</span><span class="n">bridge</span>
</pre></div>
</div>
<ul class="simple">
<li>สร้างด้วย iproute2 คำสั่ง ip</li>
<li>สร้างด้วย bridge-utils คำสั่ง brctl</li>
</ul>
</div>
<div class="section" id="iproute2">
<h4>iproute2<a class="headerlink" href="#iproute2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#bridge ชือ br0</span>
<span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">br0</span> <span class="nb">type</span> <span class="n">bridge</span>
<span class="n">ip</span> <span class="n">link</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">br0</span> <span class="n">up</span>

<span class="c1">#เพิ่ม interface (eth0) ไปยัง  bridge ต้องอยู่สถานะ up</span>
<span class="n">ip</span> <span class="n">addr</span> <span class="n">flush</span> <span class="n">eth0</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span> <span class="n">master</span> <span class="n">br0</span>
<span class="c1">#ดูสถานะ</span>
<span class="n">bridge</span> <span class="n">link</span>
<span class="c1">#ถอด  eth0 จาก br0</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span> <span class="n">nomaster</span>
<span class="c1">#ลบ bridge</span>
<span class="n">ip</span> <span class="n">link</span> <span class="n">delete</span> <span class="n">br0</span> <span class="nb">type</span> <span class="n">bridge</span>
</pre></div>
</div>
</div>
<div class="section" id="bridge-utils">
<h4>bridge-utils<a class="headerlink" href="#bridge-utils" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#bridge ชือ br0</span>
<span class="n">brctl</span> <span class="n">addbr</span> <span class="n">br0</span>
<span class="n">brctl</span> <span class="n">show</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">br0</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">addr</span> <span class="n">flush</span> <span class="n">eth0</span>
<span class="n">brctl</span> <span class="n">addif</span> <span class="n">br0</span> <span class="n">eth0</span>
<span class="n">brctl</span> <span class="n">show</span>
<span class="n">brctl</span> <span class="n">showmacs</span> <span class="n">br0</span>
<span class="c1">#mac ของ bridge คือ mac ของ eth0</span>
<span class="c1">#กำหนด ip</span>
<span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">br0</span>
<span class="n">ip</span> <span class="n">addr</span> <span class="n">show</span> <span class="n">br0</span>
<span class="n">brctl</span> <span class="n">showmacs</span> <span class="n">br0</span>

<span class="c1">#ลบbridge ต้อง down ก่อน</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">br0</span> <span class="n">down</span>
<span class="n">brctl</span> <span class="n">delbr</span> <span class="n">br0</span>
</pre></div>
</div>
<p>ที่ทำมาทั้งหมด จะหายไปเมื่อมีการ reboot เครื่อง เนื่องจากเป็นเพียง  session เท่านั้น เพื่อต้องการให้การเปลี่ยนแปลง สามารถเป็นแบบ ถาวร จะต้องทำการสร้าง  config file ให้แก่ br0 ที่  <code class="docutils literal"><span class="pre">/etc/sysconfig/network-scripts/ifcfg-br0</span></code> และทำการแก้ไข  <code class="docutils literal"><span class="pre">/etc/sysconfig/network-scripts/ifcfg-eth0</span></code></p>
<p>/etc/sysconfig/network-scripts/ifcfg-br0:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEVICE</span><span class="o">=</span><span class="n">br0</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Bridge</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span>
<span class="n">PREFIX</span><span class="o">=</span><span class="mi">24</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
<p>/etc/sysconfig/network-scripts/ifcfg-eth0:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEVICE</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">BRIDGE</span><span class="o">=</span><span class="n">br0</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Ethernet</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ovs-project">
<h2>OVS-project<a class="headerlink" href="#ovs-project" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://openvswitch.org/">http://openvswitch.org/</a></p>
<img alt="_images/ovs.png" src="_images/ovs.png" />
<div class="section" id="test-plan">
<h3>Test plan<a class="headerlink" href="#test-plan" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>ให้สร้าง vagrant file เพื่อสร้าง vm</li>
<li>ภายใน vm สร้าง 2 network name space ด้วยคำสั่ง  ip</li>
<li>สร้าง openvswitch bridge และเชื่อม network namespace เข้าหากัน</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~</span>
<span class="n">mkdir</span> <span class="n">ovs</span>
<span class="n">cd</span> <span class="n">ovs</span>
<span class="n">vagrant</span> <span class="n">init</span> <span class="n">centos</span><span class="o">/</span><span class="mi">7</span>
<span class="n">vagrant</span> <span class="n">up</span>
<span class="n">vagrant</span> <span class="n">ssh</span>
<span class="n">sudo</span> <span class="n">su</span> <span class="o">-</span>

<span class="o">//</span><span class="nb">list</span> <span class="n">ROOT</span> <span class="n">network</span> <span class="n">namespace</span>
<span class="n">ifup</span> <span class="n">eth0</span>
<span class="n">dhclient</span> <span class="n">eth0</span>
<span class="n">ip</span> <span class="n">link</span>
<span class="n">ip</span> <span class="n">a</span>
<span class="n">ip</span> <span class="n">r</span>
</pre></div>
</div>
<img alt="_images/virtdev001.png" src="_images/virtdev001.png" />
<div class="highlight-default"><div class="highlight"><pre><span></span>//create new two network namespaces
ip netns add red
ip netns add green

//list network name space
ip netns
--or--
ls /var/run/netns

//delete network namespace !!ไม่ต้องทำ
ip netns del red
ip netns del green
</pre></div>
</div>
<img alt="_images/virtdev002.png" src="_images/virtdev002.png" />
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">run</span> <span class="ow">in</span> <span class="n">network</span> <span class="n">name</span> <span class="n">space</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">a</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">green</span> <span class="n">ip</span> <span class="n">a</span>

<span class="o">//</span><span class="n">up</span> <span class="n">the</span> <span class="n">loopback</span> <span class="n">interfaces</span> <span class="p">(</span><span class="n">lo</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">namespaces</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">lo</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">green</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">lo</span> <span class="n">up</span>
</pre></div>
</div>
<img alt="_images/virtdev003.png" src="_images/virtdev003.png" />
<p>Create Switch (bridge)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">wget</span>
<span class="n">wget</span> <span class="n">ftp</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="o">.</span><span class="n">muug</span><span class="o">.</span><span class="n">mb</span><span class="o">.</span><span class="n">ca</span><span class="o">/</span><span class="n">mirror</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mf">7.2</span><span class="o">.</span><span class="mi">1511</span><span class="o">/</span><span class="n">cloud</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">openstack</span><span class="o">-</span><span class="n">kilo</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">openvswitch</span><span class="o">-</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">openvswitch</span><span class="o">-</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">openvswitch</span>
<span class="n">systemctl</span> <span class="n">enable</span> <span class="n">openvswitch</span>

<span class="n">lsmod</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">openv</span>
<span class="n">openvswitch</span>            <span class="mi">84543</span>  <span class="mi">0</span>
<span class="n">libcrc32c</span>              <span class="mi">12644</span>  <span class="mi">1</span> <span class="n">openvswitch</span>

<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">br</span> <span class="n">ovs1</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
<span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">Bridge</span> <span class="s2">&quot;ovs1&quot;</span>
    <span class="n">Port</span> <span class="s2">&quot;ovs1&quot;</span>
        <span class="n">Interface</span> <span class="s2">&quot;ovs1&quot;</span>
            <span class="nb">type</span><span class="p">:</span> <span class="n">internal</span>
<span class="n">ovs_version</span><span class="p">:</span> <span class="s2">&quot;2.4.0&quot;</span>

<span class="o">//</span><span class="nb">list</span> <span class="ow">in</span> <span class="n">ROOT</span> <span class="n">network</span> <span class="n">namespace</span>
<span class="n">ip</span> <span class="n">link</span>
</pre></div>
</div>
<img alt="_images/virtdev004.png" src="_images/virtdev004.png" />
<img alt="_images/virtdev005.png" src="_images/virtdev005.png" />
<p>การเชื่อมต่อระหว่าง openswitch กับ network name space จะเชื่อมต่อกันด้วย virtual ethernet interface pair
ทำหน้าที่เสมือนท่อระหว่าง openswitch และ network namespace <code class="docutils literal"><span class="pre">eth0-r</span> <span class="pre">&gt;--------&lt;</span> <span class="pre">veth-r</span></code></p>
<img alt="_images/virtdev006.png" src="_images/virtdev006.png" />
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">create</span> <span class="n">veth</span> <span class="n">pair</span> <span class="n">ไว้ก่อนแต่ยังไม่ได้เชื่อมกัน</span>
<span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span> <span class="nb">type</span> <span class="n">veth</span> <span class="n">peer</span> <span class="n">name</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span>
<span class="n">ip</span> <span class="n">link</span>

<span class="o">//</span> <span class="n">will</span> <span class="n">see</span> <span class="n">both</span> <span class="n">end</span> <span class="n">of</span> <span class="n">pipe</span>
<span class="mi">3</span><span class="p">:</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="n">f0</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">2</span><span class="n">f</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">c0</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="mi">4</span><span class="p">:</span> <span class="n">ovs1</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">36</span><span class="p">:</span><span class="mi">82</span><span class="p">:</span><span class="n">a4</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="n">c1</span><span class="p">:</span><span class="mi">43</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>

<span class="mi">5</span><span class="p">:</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span><span class="nd">@eth0</span><span class="o">-</span><span class="n">r</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">DOWN</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">ea</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="n">ef</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="mi">6</span><span class="p">:</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span><span class="nd">@veth</span><span class="o">-</span><span class="n">r</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">DOWN</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="n">a4</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">62</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>

<span class="o">//</span><span class="n">add</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span> <span class="n">to</span> <span class="n">red</span> <span class="n">network</span> <span class="n">namespace</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span> <span class="n">netns</span> <span class="n">red</span>
<span class="n">ip</span> <span class="n">link</span>
<span class="p">(</span><span class="n">eth0</span><span class="o">-</span><span class="n">r</span> <span class="n">หายไปจาก</span> <span class="n">root</span> <span class="n">network</span> <span class="n">name</span> <span class="n">space</span><span class="p">)</span>
<span class="mi">3</span><span class="p">:</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="n">f0</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">2</span><span class="n">f</span><span class="p">:</span><span class="n">ec</span><span class="p">:</span><span class="n">c0</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="mi">4</span><span class="p">:</span> <span class="n">ovs1</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">36</span><span class="p">:</span><span class="mi">82</span><span class="p">:</span><span class="n">a4</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="n">c1</span><span class="p">:</span><span class="mi">43</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="mi">5</span><span class="p">:</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span><span class="nd">@if6</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>

<span class="o">//</span><span class="n">check</span> <span class="ow">in</span> <span class="n">red</span> <span class="n">namespace</span> <span class="n">จะเป็นว่า</span>  <span class="n">eth0</span><span class="o">-</span><span class="n">r</span> <span class="n">มาแสดงอยู่ภายใน</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">link</span>
<span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span>
    <span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">6</span><span class="p">:</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span><span class="nd">@if5</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="n">a4</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">62</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">0</span>

<span class="o">//</span><span class="n">add</span> <span class="n">อีกข้างหนึ่งของ</span> <span class="n">veth</span> <span class="n">pair</span> <span class="n">เข้ากับ</span>  <span class="n">ovs</span> <span class="n">bridge</span> <span class="n">ในลักษณะการ</span> <span class="n">add</span> <span class="n">port</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">ovs1</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span>
<span class="n">ip</span> <span class="n">link</span>

<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">show</span>
<span class="n">ee90254e</span><span class="o">-</span><span class="mi">08</span><span class="n">b5</span><span class="o">-</span><span class="mi">4</span><span class="n">abe</span><span class="o">-</span><span class="n">a39a</span><span class="o">-</span><span class="mi">75</span><span class="n">ee07ee2ad8</span>
    <span class="n">Bridge</span> <span class="s2">&quot;ovs1&quot;</span>
        <span class="n">Port</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span>
            <span class="n">Interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span>
        <span class="n">Port</span> <span class="s2">&quot;ovs1&quot;</span>
            <span class="n">Interface</span> <span class="s2">&quot;ovs1&quot;</span>
                <span class="nb">type</span><span class="p">:</span> <span class="n">internal</span>
    <span class="n">ovs_version</span><span class="p">:</span> <span class="s2">&quot;2.4.0&quot;</span>
</pre></div>
</div>
<img alt="_images/virtdev007.png" src="_images/virtdev007.png" />
<p>ให้ทำซ้ำสำหรับการสร้าง veth pair เชื่อมต่อระหว่าง green network namespace และ openvswitch อีกครั้งหนึ่ง</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">eth0</span><span class="o">-</span><span class="n">g</span> <span class="nb">type</span> <span class="n">veth</span> <span class="n">peer</span> <span class="n">name</span> <span class="n">veth</span><span class="o">-</span><span class="n">g</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span><span class="o">-</span><span class="n">g</span> <span class="n">netns</span> <span class="n">green</span>
<span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">ovs1</span> <span class="n">veth</span><span class="o">-</span><span class="n">g</span>
</pre></div>
</div>
<img alt="_images/virtdev008.png" src="_images/virtdev008.png" />
<div class="section" id="turnon-interface-add-ip">
<h4>ขั้นตอนต่อมาคือ turnon interface และ add ip<a class="headerlink" href="#turnon-interface-add-ip" title="Permalink to this headline">¶</a></h4>
<p>Up interface</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span>
<span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="mi">5</span><span class="p">:</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span><span class="nd">@if6</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">ea</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="n">ef</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">0</span>
<span class="mi">7</span><span class="p">:</span> <span class="n">veth</span><span class="o">-</span><span class="n">g</span><span class="nd">@if8</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noop</span> <span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">DOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">a2</span><span class="p">:</span><span class="mi">5</span><span class="n">d</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">e9</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="mi">36</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">1</span>

<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">g</span> <span class="n">up</span>
<span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="mi">5</span><span class="p">:</span> <span class="n">veth</span><span class="o">-</span><span class="n">r</span><span class="nd">@if6</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">NO</span><span class="o">-</span><span class="n">CARRIER</span><span class="p">,</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">pfifo_fast</span> <span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">LOWERLAYERDOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">ea</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="n">ef</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">0</span>
<span class="mi">7</span><span class="p">:</span> <span class="n">veth</span><span class="o">-</span><span class="n">g</span><span class="nd">@if8</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">NO</span><span class="o">-</span><span class="n">CARRIER</span><span class="p">,</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">pfifo_fast</span> <span class="n">master</span> <span class="n">ovs</span><span class="o">-</span><span class="n">system</span> <span class="n">state</span> <span class="n">LOWERLAYERDOWN</span> <span class="n">mode</span> <span class="n">DEFAULT</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">a2</span><span class="p">:</span><span class="mi">5</span><span class="n">d</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">e9</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="mi">36</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">1</span>


<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">lo</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">green</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">lo</span> <span class="n">up</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">green</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">eth0</span><span class="o">-</span><span class="n">g</span> <span class="n">up</span>
</pre></div>
</div>
<p>Add ip</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">In</span> <span class="n">read</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">a</span> <span class="n">add</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">a</span>

<span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span>
    <span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
    <span class="n">inet</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="p">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span> <span class="n">scope</span> <span class="n">host</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
<span class="mi">6</span><span class="p">:</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span><span class="nd">@if5</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">pfifo_fast</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="n">a4</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">62</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">0</span>
    <span class="n">inet</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="n">fe80</span><span class="p">::</span><span class="n">f7</span><span class="p">:</span><span class="n">edff</span><span class="p">:</span><span class="n">fea4</span><span class="p">:</span><span class="mi">3062</span><span class="o">/</span><span class="mi">64</span> <span class="n">scope</span> <span class="n">link</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>

<span class="o">//</span><span class="n">check</span> <span class="n">route</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">r</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">eth0</span><span class="o">-</span><span class="n">r</span>  <span class="n">proto</span> <span class="n">kernel</span>  <span class="n">scope</span> <span class="n">link</span>  <span class="n">src</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span>

<span class="o">//</span><span class="n">In</span> <span class="n">root</span>
<span class="o">//</span><span class="n">checkroute</span> <span class="n">ใน</span> <span class="n">root</span> <span class="n">namespace</span> <span class="n">จะเห็นว่า</span> <span class="n">ยังไม่รับทราบ</span> <span class="n">ถึง</span> <span class="n">network</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span>
<span class="n">ip</span> <span class="n">route</span>
<span class="n">default</span> <span class="n">via</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">121.1</span> <span class="n">dev</span> <span class="n">eth0</span>  <span class="n">proto</span> <span class="n">static</span>  <span class="n">metric</span> <span class="mi">100</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">121.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">eth0</span>  <span class="n">proto</span> <span class="n">kernel</span>  <span class="n">scope</span> <span class="n">link</span>  <span class="n">src</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">121.189</span>  <span class="n">metric</span> <span class="mi">100</span>

<span class="o">//</span><span class="n">In</span> <span class="n">green</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">green</span> <span class="n">ip</span> <span class="n">a</span> <span class="n">add</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">eth0</span><span class="o">-</span><span class="n">g</span>
<span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">green</span> <span class="n">ip</span> <span class="n">a</span>
<span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span>
    <span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
    <span class="n">inet</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="p">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span> <span class="n">scope</span> <span class="n">host</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
<span class="mi">8</span><span class="p">:</span> <span class="n">eth0</span><span class="o">-</span><span class="n">g</span><span class="nd">@if7</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">pfifo_fast</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="n">d0</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">0</span>
    <span class="n">inet</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="o">/</span><span class="mi">24</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">eth0</span><span class="o">-</span><span class="n">g</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">9</span><span class="n">e</span><span class="p">:</span><span class="mi">59</span><span class="n">ff</span><span class="p">:</span><span class="n">fee8</span><span class="p">:</span><span class="mi">76</span><span class="n">d0</span><span class="o">/</span><span class="mi">64</span> <span class="n">scope</span> <span class="n">link</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</pre></div>
</div>
<img alt="_images/virtdev009.png" src="_images/virtdev009.png" />
<p>Test ping</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">bash</span>
<span class="n">ping</span> <span class="o">-</span><span class="n">c</span> <span class="mi">4</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.503</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.061</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.076</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.061</span> <span class="n">ms</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="packstack.html" class="btn btn-neutral float-right" title="Openstack with Packstack" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="iscsi.html" class="btn btn-neutral" title="ISCSI Remote Storage" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, sawangpong muadphet &lt;sawangpong@itbakery.net&gt;.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'latest',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>